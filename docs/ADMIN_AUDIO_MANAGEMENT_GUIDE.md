# راهنمای مدیریت فایل‌های صوتی - پنل مدیریت سروکست

## مقدمه

این راهنما برای مدیران سروکست تهیه شده است تا بتوانند فایل‌های صوتی قسمت‌ها را به طور کامل مدیریت کنند. تمامی عملیات مربوط به فایل‌های صوتی فقط از طریق پنل مدیریت قابل انجام است.

## ویژگی‌های سیستم مدیریت صدا

### 1. آپلود فایل‌های صوتی
- آپلود فایل‌های صوتی برای قسمت‌ها
- پشتیبانی از فرمت‌های مختلف (MP3, WAV, OGG, M4A, AAC)
- محدودیت حجم فایل (حداکثر 50 مگابایت)
- پردازش خودکار فایل‌های آپلود شده

### 2. پردازش فایل‌های صوتی
- استخراج metadata از فایل‌های صوتی
- نرمال‌سازی صدا
- تبدیل فرمت فایل‌ها
- برش فایل‌های صوتی
- تولید waveform
- اعتبارسنجی فایل‌های صوتی

### 3. مدیریت و آمار
- نمایش آمار کلی فایل‌های صوتی
- لیست آخرین آپلودها
- مدیریت فایل‌های صوتی موجود
- عملیات گروهی روی فایل‌ها

## دسترسی به سیستم

### 1. ورود به پنل مدیریت
```
https://sarvcast.com/admin/audio
```

### 2. احراز هویت
- ورود با شماره تلفن و رمز عبور
- دسترسی فقط برای کاربران با نقش Admin

## رابط کاربری

### 1. داشبورد اصلی
- **آمار کلی**: نمایش تعداد کل قسمت‌ها، قسمت‌های دارای فایل صوتی، میانگین مدت و حجم کل
- **آخرین آپلودها**: لیست 10 فایل صوتی آخر که آپلود شده‌اند
- **دکمه آپلود**: برای آپلود فایل صوتی جدید

### 2. کارت‌های آمار
- **کل قسمت‌ها**: تعداد کل قسمت‌های موجود در سیستم
- **با فایل صوتی**: تعداد قسمت‌هایی که فایل صوتی دارند
- **میانگین مدت**: میانگین مدت فایل‌های صوتی (به ثانیه)
- **حجم کل**: مجموع حجم تمام فایل‌های صوتی (به مگابایت)

## آپلود فایل صوتی

### 1. مراحل آپلود
1. کلیک روی دکمه "آپلود فایل صوتی"
2. انتخاب قسمت مورد نظر از لیست
3. انتخاب فایل صوتی از کامپیوتر
4. وارد کردن عنوان و توضیحات (اختیاری)
5. کلیک روی دکمه "آپلود"

### 2. فرمت‌های پشتیبانی شده
- **MP3**: فرمت استاندارد و پرکاربرد
- **WAV**: فرمت بدون فشرده‌سازی
- **OGG**: فرمت متن‌باز
- **M4A**: فرمت اپل
- **AAC**: فرمت فشرده با کیفیت بالا

### 3. محدودیت‌ها
- **حداکثر حجم**: 50 مگابایت
- **حداقل حجم**: 1 کیلوبایت
- **حداکثر مدت**: 2 ساعت
- **حداقل مدت**: 1 ثانیه

### 4. پردازش خودکار
پس از آپلود، فایل صوتی به طور خودکار پردازش می‌شود:
- استخراج metadata (مدت، بیت‌ریت، فرکانس نمونه‌برداری)
- نرمال‌سازی صدا
- تولید waveform برای نمایش بصری
- اعتبارسنجی فایل

## مدیریت فایل‌های موجود

### 1. نمایش فایل‌ها
- **جدول آخرین آپلودها**: نمایش 10 فایل آخر
- **ستون‌های اطلاعات**: عنوان، فرمت، مدت، حجم، تاریخ آپلود
- **عملیات**: مشاهده جزئیات، حذف فایل

### 2. عملیات روی فایل‌ها
- **مشاهده جزئیات**: نمایش اطلاعات کامل فایل صوتی
- **حذف فایل**: حذف فایل صوتی از سیستم
- **پردازش مجدد**: پردازش مجدد فایل موجود

### 3. عملیات گروهی
- **پردازش گروهی**: پردازش چندین فایل به طور همزمان
- **حذف گروهی**: حذف چندین فایل به طور همزمان
- **نرمال‌سازی گروهی**: نرمال‌سازی چندین فایل
- **تبدیل فرمت گروهی**: تبدیل فرمت چندین فایل

## API Endpoints

### 1. دریافت آمار
```http
GET /api/v1/admin/audio-management
Authorization: Bearer {admin_token}
```

**پاسخ:**
```json
{
  "success": true,
  "message": "داشبورد مدیریت صدا دریافت شد",
  "data": {
    "stats": {
      "total_episodes": 150,
      "episodes_with_audio": 120,
      "episodes_without_audio": 30,
      "audio_coverage_percentage": 80.0,
      "total_audio_size": 2048576000,
      "total_audio_size_mb": 1953.13,
      "average_duration": 180.5,
      "audio_formats": {
        "mp3": 100,
        "wav": 15,
        "ogg": 5
      }
    },
    "recent_uploads": [...],
    "processing_queue": {...},
    "storage_info": {...}
  }
}
```

### 2. آپلود فایل صوتی
```http
POST /api/v1/admin/audio-management/upload
Authorization: Bearer {admin_token}
Content-Type: multipart/form-data
```

**بدنه درخواست:**
```json
{
  "audio_file": "file",
  "episode_id": 123,
  "title": "عنوان قسمت",
  "description": "توضیحات قسمت"
}
```

**پاسخ:**
```json
{
  "success": true,
  "message": "فایل صوتی با موفقیت آپلود و پردازش شد",
  "data": {
    "episode_id": 123,
    "file_path": "audio/episodes/1640995200_episode.mp3",
    "duration": 180,
    "file_size": 2048576,
    "processing_result": {
      "metadata": {...},
      "waveform": [...],
      "normalized": true
    }
  }
}
```

### 3. پردازش فایل صوتی
```http
POST /api/v1/admin/audio/process
Authorization: Bearer {admin_token}
```

**بدنه درخواست:**
```json
{
  "episode_id": 123,
  "operations": ["normalize", "convert", "extract_metadata"]
}
```

### 4. دریافت اطلاعات فایل
```http
GET /api/v1/admin/episodes/{id}/audio-info
Authorization: Bearer {admin_token}
```

### 5. حذف فایل صوتی
```http
DELETE /api/v1/admin/episodes/{id}/audio
Authorization: Bearer {admin_token}
```

### 6. عملیات گروهی
```http
POST /api/v1/admin/audio-management/bulk-operation
Authorization: Bearer {admin_token}
```

**بدنه درخواست:**
```json
{
  "operation": "process",
  "episode_ids": [123, 124, 125],
  "options": {
    "operations": ["normalize", "extract_metadata"]
  }
}
```

## امنیت و دسترسی

### 1. احراز هویت
- تمام endpoints نیاز به token معتبر دارند
- فقط کاربران با نقش Admin دسترسی دارند
- بررسی middleware admin برای تمام درخواست‌ها

### 2. اعتبارسنجی فایل
- بررسی فرمت فایل قبل از آپلود
- اسکن فایل برای ویروس و بدافزار
- محدودیت حجم و مدت فایل
- بررسی metadata فایل

### 3. محافظت از فایل‌ها
- ذخیره فایل‌ها در مسیر امن
- تنظیم مجوزهای مناسب برای فایل‌ها
- پشتیبان‌گیری منظم از فایل‌ها
- رمزگذاری فایل‌های حساس

## عیب‌یابی

### 1. مشکلات رایج

#### فایل آپلود نمی‌شود
- بررسی حجم فایل (باید کمتر از 50MB باشد)
- بررسی فرمت فایل (باید از فرمت‌های پشتیبانی شده باشد)
- بررسی اتصال اینترنت
- بررسی فضای خالی سرور

#### پردازش فایل ناموفق
- بررسی کیفیت فایل صوتی
- بررسی metadata فایل
- بررسی منابع سرور
- بررسی لاگ‌های سیستم

#### خطای دسترسی
- بررسی token احراز هویت
- بررسی نقش کاربر (باید Admin باشد)
- بررسی مجوزهای فایل
- بررسی تنظیمات سرور

### 2. لاگ‌ها و مانیتورینگ
- لاگ‌های آپلود در `/storage/logs/audio-upload.log`
- لاگ‌های پردازش در `/storage/logs/audio-processing.log`
- مانیتورینگ استفاده از منابع سرور
- آمار عملکرد سیستم

## بهترین روش‌ها

### 1. آپلود فایل‌ها
- استفاده از فرمت MP3 برای فایل‌های نهایی
- فشرده‌سازی مناسب فایل‌ها
- استفاده از کیفیت مناسب (128-320 kbps)
- نام‌گذاری مناسب فایل‌ها

### 2. مدیریت فایل‌ها
- پاک‌سازی منظم فایل‌های غیرضروری
- پشتیبان‌گیری منظم از فایل‌ها
- مانیتورینگ استفاده از فضای ذخیره
- به‌روزرسانی منظم سیستم

### 3. امنیت
- استفاده از HTTPS برای آپلود
- بررسی منظم فایل‌های آپلود شده
- محدود کردن دسترسی به فایل‌ها
- رمزگذاری فایل‌های حساس

## پشتیبانی

### تماس با تیم فنی
- ایمیل: support@sarvcast.com
- تلفن: 021-12345678
- تلگرام: @SarvCastSupport

### منابع مفید
- [راهنمای API](./API_DOCUMENTATION_COMPLETE.md)
- [راهنمای امنیت](./SECURITY_AUDIT_REPORT.md)
- [راهنمای پشتیبان‌گیری](./BACKUP_RECOVERY_PROCEDURES.md)

---

**نکته مهم**: این راهنما برای مدیران سروکست تهیه شده است. برای سوالات فنی، با تیم پشتیبانی تماس بگیرید.
